# ç æµ·ä¼˜ç¾å®˜ç½‘ - å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆæ¦‚è§ˆ

æœ¬é¡¹ç›®æä¾›äº†ä¸¤ç§å®Œæ•´çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œæ»¡è¶³ä¸åŒçš„éƒ¨ç½²éœ€æ±‚å’Œç¯å¢ƒï¼š

### ğŸ“¦ æ–¹æ¡ˆä¸€ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²
- **é€‚ç”¨åœºæ™¯**: å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€äº‘å¹³å°éƒ¨ç½²
- **ä¼˜åŠ¿**: ç¯å¢ƒéš”ç¦»ã€æ˜“äºæ‰©å±•ã€è·¨å¹³å°å…¼å®¹
- **æŠ€æœ¯æ ˆ**: Docker + Docker Compose + å®¹å™¨ç¼–æ’

### ğŸ–¥ï¸ æ–¹æ¡ˆäºŒï¼šUbuntu 22.04åŸç”Ÿéƒ¨ç½²
- **é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€ä¼ ç»ŸæœåŠ¡å™¨ã€VPSéƒ¨ç½²
- **ä¼˜åŠ¿**: æ€§èƒ½æœ€ä¼˜ã€èµ„æºåˆ©ç”¨ç‡é«˜ã€è¿ç»´ç†Ÿæ‚‰
- **æŠ€æœ¯æ ˆ**: Ubuntu + Systemd + åŸç”ŸæœåŠ¡

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”åˆ†æ

| ç‰¹æ€§ | Dockeréƒ¨ç½² | UbuntuåŸç”Ÿéƒ¨ç½² |
|------|------------|----------------|
| **éƒ¨ç½²éš¾åº¦** | â­â­ ç®€å• | â­â­â­ ä¸­ç­‰ |
| **æ€§èƒ½** | â­â­â­ è‰¯å¥½ | â­â­â­â­ ä¼˜ç§€ |
| **èµ„æºæ¶ˆè€—** | â­â­ è¾ƒé«˜ | â­â­â­â­ è¾ƒä½ |
| **æ‰©å±•æ€§** | â­â­â­â­ ä¼˜ç§€ | â­â­â­ è‰¯å¥½ |
| **è¿ç»´å¤æ‚åº¦** | â­â­ ç®€å• | â­â­â­ ä¸­ç­‰ |
| **ç¯å¢ƒéš”ç¦»** | â­â­â­â­ ä¼˜ç§€ | â­â­ ä¸€èˆ¬ |
| **æ•…éšœæ’æŸ¥** | â­â­â­ è‰¯å¥½ | â­â­â­â­ ä¼˜ç§€ |
| **å¤‡ä»½æ¢å¤** | â­â­â­â­ ä¼˜ç§€ | â­â­â­ è‰¯å¥½ |

---

## ğŸ³ Dockeréƒ¨ç½²æ–¹æ¡ˆ

### ğŸ’° æˆæœ¬é¢„ä¼°
```bash
# æœ€å°é…ç½® (å¼€å‘/æµ‹è¯•)
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç£ç›˜: 40GB SSD
- æˆæœ¬: 200-400å…ƒ/æœˆ

# æ¨èé…ç½® (ç”Ÿäº§ç¯å¢ƒ)
- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç£ç›˜: 100GB SSD
- æˆæœ¬: 400-800å…ƒ/æœˆ
```

### ğŸš€ å¿«é€Ÿéƒ¨ç½²

#### 1. å‡†å¤‡ç¯å¢ƒ
```bash
# Ubuntu 22.04/20.04, CentOS 8, Debian 11
# å®‰è£…Dockerå’ŒDocker Compose
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### 2. ä¸‹è½½é¡¹ç›®
```bash
git clone https://github.com/your-username/zhuhai-youmei-docker.git
cd zhuhai-youmei-docker
```

#### 3. é…ç½®ç¯å¢ƒ
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

#### 4. ä¸€é”®éƒ¨ç½²
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/deploy.sh

# æ‰§è¡Œéƒ¨ç½²
./scripts/deploy.sh
```

#### 5. è®¿é—®åº”ç”¨
```bash
# å¼€å‘ç¯å¢ƒ
å‰ç«¯: http://localhost
åç«¯: http://localhost:8000
ç®¡ç†åå°: http://localhost:8000/admin/

# ç”Ÿäº§ç¯å¢ƒ (é…ç½®åŸŸåå)
å‰ç«¯: https://your-domain.com
åç«¯: https://api.your-domain.com
```

### ğŸ”§ Dockerç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
./scripts/logs.sh all          # æ‰€æœ‰æœåŠ¡
./scripts/logs.sh backend      # åç«¯æœåŠ¡
./scripts/logs.sh nginx        # NginxæœåŠ¡

# é‡å¯æœåŠ¡
docker-compose restart backend
docker-compose restart nginx

# è¿›å…¥å®¹å™¨
docker-compose exec backend bash
docker-compose exec postgres psql -U youmei_user -d zhuhai_youmei

# å¤‡ä»½æ•°æ®
./scripts/backup.sh

# æ›´æ–°éƒ¨ç½²
git pull
docker-compose build
docker-compose up -d

# æ¸…ç†èµ„æº
docker system prune -a        # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker-compose down -v         # åœæ­¢å¹¶åˆ é™¤å·
```

### ğŸ“¦ DockeræœåŠ¡æ¶æ„

```yaml
services:
  nginx:      # WebæœåŠ¡å™¨/åå‘ä»£ç†
    ports: 80, 443

  frontend:   # Vue.jså‰ç«¯åº”ç”¨
    internal: 3000

  backend:    # Djangoåç«¯API
    internal: 8000

  postgres:   # PostgreSQLæ•°æ®åº“
    internal: 5432

  redis:      # Redisç¼“å­˜
    internal: 6379
```

---

## ğŸ–¥ï¸ UbuntuåŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆ

### ğŸ’° æˆæœ¬é¢„ä¼°
```bash
# æœ€å°é…ç½® (ä¸­å°ä¼ä¸š)
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç£ç›˜: 60GB SSD
- æˆæœ¬: 150-300å…ƒ/æœˆ

# æ¨èé…ç½® (å¤§å‹ä¼ä¸š)
- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç£ç›˜: 100GB SSD
- æˆæœ¬: 350-600å…ƒ/æœˆ
```

### ğŸš€ ä¸€é”®éƒ¨ç½²

#### 1. ä¸‹è½½è„šæœ¬
```bash
# ç›´æ¥ä¸‹è½½
wget https://raw.githubusercontent.com/your-repo/deploy-script.sh
chmod +x deploy-script.sh

# æˆ–è€…å…‹éš†ä»“åº“
git clone https://github.com/your-username/zhuhai-youmei-deploy.git
cd zhuhai-youmei-deploy
chmod +x Ubuntu22.04ä¸€é”®éƒ¨ç½²è„šæœ¬.sh
```

#### 2. æ‰§è¡Œéƒ¨ç½²
```bash
# è¿è¡Œéƒ¨ç½²è„šæœ¬
./Ubuntu22.04ä¸€é”®éƒ¨ç½²è„šæœ¬.sh

# æˆ–è€…å¸¦å‚æ•°
./Ubuntu22.04ä¸€é”®éƒ¨ç½²è„šæœ¬.sh deploy
```

#### 3. è·Ÿéšå¼•å¯¼
```bash
# è„šæœ¬ä¼šå¼•å¯¼æ‚¨è¾“å…¥:
- åŸŸå (ä¾‹å¦‚: example.com)
- ç®¡ç†å‘˜é‚®ç®±
- æ•°æ®åº“å¯†ç 
- Rediså¯†ç 
- Djangoç®¡ç†å‘˜å¯†ç 
```

#### 4. è‡ªåŠ¨åŒ–å®‰è£…
```bash
# è„šæœ¬è‡ªåŠ¨å®Œæˆ:
âœ… ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥
âœ… è½¯ä»¶åŒ…å®‰è£… (Node.js, Python, PostgreSQLç­‰)
âœ… æ•°æ®åº“é…ç½®
âœ… Djangoé¡¹ç›®éƒ¨ç½²
âœ… Vueå‰ç«¯æ„å»º
âœ… Nginxé…ç½®
âœ… SSLè¯ä¹¦ç”³è¯·
âœ… æœåŠ¡å¯åŠ¨
âœ… éƒ¨ç½²éªŒè¯
```

### ğŸ”§ Ubuntuç®¡ç†å‘½ä»¤

```bash
# é¡¹ç›®ç®¡ç†è„šæœ¬
/var/www/zhuhai-youmei/scripts/status.sh    # æŸ¥çœ‹çŠ¶æ€
/var/www/zhuhai-youmei/scripts/logs.sh      # æŸ¥çœ‹æ—¥å¿—
/var/www/zhuhai-youmei/scripts/deploy.sh    # æ›´æ–°éƒ¨ç½²
/var/www/zhuhai-youmei/scripts/backup.sh    # æ•°æ®å¤‡ä»½

# æœåŠ¡ç®¡ç†
sudo systemctl restart nginx                           # é‡å¯Nginx
sudo supervisorctl restart zhuhai-youmei-backend      # é‡å¯åç«¯
sudo systemctl restart postgresql                     # é‡å¯æ•°æ®åº“
sudo systemctl restart redis-server                   # é‡å¯Redis

# åº”ç”¨ç®¡ç†
cd /var/www/zhuhai-youmei/backend
source venv/bin/activate
python manage.py migrate                              # æ•°æ®åº“è¿ç§»
python manage.py collectstatic --noinput             # æ”¶é›†é™æ€æ–‡ä»¶
python manage.py createsuperuser                     # åˆ›å»ºç®¡ç†å‘˜

# æ—¥å¿—æŸ¥çœ‹
tail -f /var/www/zhuhai-youmei/logs/backend.log       # åç«¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log                # Nginxæ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-15-main.log  # æ•°æ®åº“æ—¥å¿—
```

### ğŸ—ï¸ UbuntuæœåŠ¡æ¶æ„

```bash
ç³»ç»ŸæœåŠ¡:
â”œâ”€â”€ Nginx (ç«¯å£: 80, 443)
â”‚   â”œâ”€â”€ å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡
â”‚   â””â”€â”€ APIåå‘ä»£ç†
â”œâ”€â”€ Gunicorn + Supervisor
â”‚   â””â”€â”€ Djangoåº”ç”¨ (ç«¯å£: 8000)
â”œâ”€â”€ PostgreSQL (ç«¯å£: 5432)
â””â”€â”€ Redis (ç«¯å£: 6379)

é¡¹ç›®ç»“æ„:
/var/www/zhuhai-youmei/
â”œâ”€â”€ backend/           # Djangoåç«¯
â”œâ”€â”€ frontend/          # Vueå‰ç«¯
â”œâ”€â”€ logs/             # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ backups/          # å¤‡ä»½æ–‡ä»¶
â””â”€â”€ scripts/          # ç®¡ç†è„šæœ¬
```

---

## ğŸ¯ é€‰æ‹©å»ºè®®

### ğŸ³ é€‰æ‹©Dockeréƒ¨ç½²çš„æƒ…å†µï¼š

**âœ… æ¨èåœºæ™¯ï¼š**
- å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
- éœ€è¦å¿«é€Ÿéƒ¨ç½²å’Œè¿ç§»
- å›¢é˜Ÿå¯¹Dockerç†Ÿæ‚‰
- éœ€è¦å¤šç¯å¢ƒä¸€è‡´æ€§
- è®¡åˆ’ä½¿ç”¨äº‘åŸç”Ÿå¹³å°

**âœ… ä¼˜åŠ¿ï¼š**
- ç¯å¢ƒä¸€è‡´æ€§å¥½
- éƒ¨ç½²ç®€å•å¿«é€Ÿ
- æ˜“äºæ‰©å±•å’Œè¿ç§»
- æœåŠ¡éš”ç¦»å®‰å…¨
- æ”¯æŒCI/CDè‡ªåŠ¨åŒ–

**âŒ ä¸é€‚åˆï¼š**
- æœåŠ¡å™¨èµ„æºæœ‰é™
- å¯¹æ€§èƒ½è¦æ±‚æé«˜
- å›¢é˜Ÿä¸ç†Ÿæ‚‰å®¹å™¨æŠ€æœ¯

### ğŸ–¥ï¸ é€‰æ‹©UbuntuåŸç”Ÿéƒ¨ç½²çš„æƒ…å†µï¼š

**âœ… æ¨èåœºæ™¯ï¼š**
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- å¯¹æ€§èƒ½è¦æ±‚é«˜
- æœåŠ¡å™¨èµ„æºæœ‰é™
- ä¼ ç»Ÿè¿ç»´å›¢é˜Ÿ
- éœ€è¦ç²¾ç»†åŒ–æ§åˆ¶

**âœ… ä¼˜åŠ¿ï¼š**
- æ€§èƒ½æœ€ä¼˜
- èµ„æºåˆ©ç”¨ç‡é«˜
- æ•…éšœæ’æŸ¥å®¹æ˜“
- è¿ç»´å›¢é˜Ÿç†Ÿæ‚‰
- æˆæœ¬ç›¸å¯¹è¾ƒä½

**âŒ ä¸é€‚åˆï¼š**
- éœ€è¦é¢‘ç¹è¿ç§»
- å¤šç¯å¢ƒç®¡ç†å¤æ‚
- å›¢é˜Ÿç¼ºä¹Linuxç»éªŒ

---

## ğŸ”„ è¿ç§»å’Œå‡çº§

### Docker â†’ Ubuntuè¿ç§»
```bash
# 1. å¯¼å‡ºDockeræ•°æ®
docker-compose exec postgres pg_dump -U youmei_user zhuhai_youmei > backup.sql
docker cp container_name:/app/media ./media_backup

# 2. åœ¨Ubuntuç¯å¢ƒæ¢å¤
./Ubuntu22.04ä¸€é”®éƒ¨ç½²è„šæœ¬.sh deploy
psql -h localhost -U deploy zhuhai_youmei < backup.sql
cp -r media_backup/* /var/www/zhuhai-youmei/backend/media/
```

### Ubuntu â†’ Dockerè¿ç§»
```bash
# 1. å¯¼å‡ºUbuntuæ•°æ®
pg_dump -h localhost -U deploy zhuhai_youmei > backup.sql
tar -czf media_backup.tar.gz /var/www/zhuhai-youmei/backend/media/

# 2. åœ¨Dockerç¯å¢ƒæ¢å¤
./scripts/deploy.sh
docker-compose exec postgres psql -U youmei_user zhuhai_youmei < backup.sql
docker cp media_backup.tar.gz container_name:/app/
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### Dockeréƒ¨ç½²é—®é¢˜

```bash
# 1. å®¹å™¨å¯åŠ¨å¤±è´¥
docker-compose logs backend                    # æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose up backend                      # å‰å°å¯åŠ¨æŸ¥çœ‹é”™è¯¯

# 2. æ•°æ®åº“è¿æ¥å¤±è´¥
docker-compose exec postgres psql -U youmei_user -d zhuhai_youmei
docker-compose restart postgres

# 3. ç«¯å£å†²çª
docker-compose down                            # åœæ­¢æ‰€æœ‰æœåŠ¡
sudo netstat -tlnp | grep :80                 # æ£€æŸ¥ç«¯å£å ç”¨
sudo pkill -f nginx                           # æ€æ­»å ç”¨è¿›ç¨‹

# 4. ç£ç›˜ç©ºé—´ä¸è¶³
docker system prune -a                        # æ¸…ç†æœªä½¿ç”¨é•œåƒ
docker volume prune                           # æ¸…ç†æœªä½¿ç”¨å·
```

#### Ubuntuéƒ¨ç½²é—®é¢˜

```bash
# 1. æœåŠ¡å¯åŠ¨å¤±è´¥
sudo systemctl status nginx                   # æ£€æŸ¥NginxçŠ¶æ€
sudo supervisorctl status zhuhai-youmei-backend  # æ£€æŸ¥åç«¯çŠ¶æ€
sudo nginx -t                                # æµ‹è¯•Nginxé…ç½®

# 2. æ•°æ®åº“è¿æ¥å¤±è´¥
sudo systemctl status postgresql              # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
sudo -u postgres psql -l                     # æ£€æŸ¥æ•°æ®åº“åˆ—è¡¨

# 3. æƒé™é—®é¢˜
sudo chown -R $USER:$USER /var/www/zhuhai-youmei
sudo chmod -R 755 /var/www/zhuhai-youmei

# 4. SSLè¯ä¹¦é—®é¢˜
sudo certbot certificates                     # æ£€æŸ¥è¯ä¹¦çŠ¶æ€
sudo certbot renew                           # æ‰‹åŠ¨ç»­æœŸ
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©

**ğŸ“š æ–‡æ¡£èµ„æºï¼š**
- Dockeréƒ¨ç½²æŒ‡å—ï¼š`.same/Dockerå®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ.md`
- Ubuntuéƒ¨ç½²æŒ‡å—ï¼š`.same/Djangoåç«¯éƒ¨ç½²æŒ‡å—.md`
- å‰ç«¯éƒ¨ç½²æŒ‡å—ï¼š`.same/é˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å—.md`

**ğŸ› ï¸ è°ƒè¯•å·¥å…·ï¼š**
```bash
# Dockerç¯å¢ƒ
docker-compose logs -f                        # å®æ—¶æ—¥å¿—
docker stats                                  # èµ„æºä½¿ç”¨
docker-compose exec backend python manage.py shell  # Django shell

# Ubuntuç¯å¢ƒ
/var/www/zhuhai-youmei/scripts/status.sh      # ç³»ç»ŸçŠ¶æ€
/var/www/zhuhai-youmei/scripts/logs.sh all    # ç»¼åˆæ—¥å¿—
htop                                          # ç³»ç»Ÿç›‘æ§
```

**ğŸ”§ å¸¸ç”¨å‘½ä»¤ï¼š**
```bash
# å¥åº·æ£€æŸ¥
curl -f http://localhost/health/              # æ£€æŸ¥APIå¥åº·
curl -f http://localhost/                     # æ£€æŸ¥å‰ç«¯

# æ€§èƒ½æµ‹è¯•
ab -n 100 -c 10 http://localhost/            # Apache Benchæµ‹è¯•
curl -w "@curl-format.txt" -o /dev/null -s http://localhost/  # å“åº”æ—¶é—´
```

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸåçš„ä¸‹ä¸€æ­¥

### 1. å®‰å…¨åŠ å›º
```bash
# è®¾ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'

# å®‰è£…fail2ban
sudo apt install fail2ban

# å®šæœŸå®‰å…¨æ›´æ–°
sudo apt update && sudo apt upgrade -y
```

### 2. æ€§èƒ½ä¼˜åŒ–
```bash
# æ•°æ®åº“ä¼˜åŒ–
sudo nano /etc/postgresql/15/main/postgresql.conf

# Nginxä¼˜åŒ–
sudo nano /etc/nginx/nginx.conf

# å¯ç”¨HTTP/2
# é…ç½®ç¼“å­˜ç­–ç•¥
```

### 3. ç›‘æ§è®¾ç½®
```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt install htop iotop nethogs

# è®¾ç½®æ—¥å¿—è½®è½¬
sudo nano /etc/logrotate.d/zhuhai-youmei

# é…ç½®å‘Šè­¦é€šçŸ¥
```

### 4. å¤‡ä»½ç­–ç•¥
```bash
# è®¾ç½®å®šæ—¶å¤‡ä»½
crontab -e
# æ·»åŠ ï¼š0 2 * * * /var/www/zhuhai-youmei/scripts/backup.sh

# å¼‚åœ°å¤‡ä»½
rsync -avz /var/www/zhuhai-youmei/backups/ user@backup-server:/backups/
```

---

ğŸŠ **æ­å–œï¼æ‚¨å·²æˆåŠŸéƒ¨ç½²ç æµ·ä¼˜ç¾åŒ–å¦†å“å®˜ç½‘ï¼**

æ— è®ºé€‰æ‹©å“ªç§éƒ¨ç½²æ–¹æ¡ˆï¼Œéƒ½èƒ½ä¸ºæ‚¨æä¾›ç¨³å®šã€é«˜æ€§èƒ½çš„ç½‘ç«™æœåŠ¡ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸åº”çš„æ•…éšœæ’é™¤æŒ‡å—æˆ–æŸ¥çœ‹è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£ã€‚
