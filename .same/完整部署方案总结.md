# 珠海优美官网 - 完整部署方案总结

## 🎯 部署方案概览

本项目提供了两种完整的部署方案，满足不同的部署需求和环境：

### 📦 方案一：Docker容器化部署
- **适用场景**: 开发环境、测试环境、云平台部署
- **优势**: 环境隔离、易于扩展、跨平台兼容
- **技术栈**: Docker + Docker Compose + 容器编排

### 🖥️ 方案二：Ubuntu 22.04原生部署
- **适用场景**: 生产环境、传统服务器、VPS部署
- **优势**: 性能最优、资源利用率高、运维熟悉
- **技术栈**: Ubuntu + Systemd + 原生服务

---

## 📊 方案对比分析

| 特性 | Docker部署 | Ubuntu原生部署 |
|------|------------|----------------|
| **部署难度** | ⭐⭐ 简单 | ⭐⭐⭐ 中等 |
| **性能** | ⭐⭐⭐ 良好 | ⭐⭐⭐⭐ 优秀 |
| **资源消耗** | ⭐⭐ 较高 | ⭐⭐⭐⭐ 较低 |
| **扩展性** | ⭐⭐⭐⭐ 优秀 | ⭐⭐⭐ 良好 |
| **运维复杂度** | ⭐⭐ 简单 | ⭐⭐⭐ 中等 |
| **环境隔离** | ⭐⭐⭐⭐ 优秀 | ⭐⭐ 一般 |
| **故障排查** | ⭐⭐⭐ 良好 | ⭐⭐⭐⭐ 优秀 |
| **备份恢复** | ⭐⭐⭐⭐ 优秀 | ⭐⭐⭐ 良好 |

---

## 🐳 Docker部署方案

### 💰 成本预估
```bash
# 最小配置 (开发/测试)
- CPU: 2核
- 内存: 4GB
- 磁盘: 40GB SSD
- 成本: 200-400元/月

# 推荐配置 (生产环境)
- CPU: 4核
- 内存: 8GB
- 磁盘: 100GB SSD
- 成本: 400-800元/月
```

### 🚀 快速部署

#### 1. 准备环境
```bash
# Ubuntu 22.04/20.04, CentOS 8, Debian 11
# 安装Docker和Docker Compose
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### 2. 下载项目
```bash
git clone https://github.com/your-username/zhuhai-youmei-docker.git
cd zhuhai-youmei-docker
```

#### 3. 配置环境
```bash
# 复制环境配置
cp .env.example .env

# 编辑配置文件
nano .env
```

#### 4. 一键部署
```bash
# 给脚本执行权限
chmod +x scripts/deploy.sh

# 执行部署
./scripts/deploy.sh
```

#### 5. 访问应用
```bash
# 开发环境
前端: http://localhost
后端: http://localhost:8000
管理后台: http://localhost:8000/admin/

# 生产环境 (配置域名后)
前端: https://your-domain.com
后端: https://api.your-domain.com
```

### 🔧 Docker管理命令

```bash
# 查看所有服务状态
docker-compose ps

# 查看服务日志
./scripts/logs.sh all          # 所有服务
./scripts/logs.sh backend      # 后端服务
./scripts/logs.sh nginx        # Nginx服务

# 重启服务
docker-compose restart backend
docker-compose restart nginx

# 进入容器
docker-compose exec backend bash
docker-compose exec postgres psql -U youmei_user -d zhuhai_youmei

# 备份数据
./scripts/backup.sh

# 更新部署
git pull
docker-compose build
docker-compose up -d

# 清理资源
docker system prune -a        # 清理未使用的镜像
docker-compose down -v         # 停止并删除卷
```

### 📦 Docker服务架构

```yaml
services:
  nginx:      # Web服务器/反向代理
    ports: 80, 443

  frontend:   # Vue.js前端应用
    internal: 3000

  backend:    # Django后端API
    internal: 8000

  postgres:   # PostgreSQL数据库
    internal: 5432

  redis:      # Redis缓存
    internal: 6379
```

---

## 🖥️ Ubuntu原生部署方案

### 💰 成本预估
```bash
# 最小配置 (中小企业)
- CPU: 2核
- 内存: 4GB
- 磁盘: 60GB SSD
- 成本: 150-300元/月

# 推荐配置 (大型企业)
- CPU: 4核
- 内存: 8GB
- 磁盘: 100GB SSD
- 成本: 350-600元/月
```

### 🚀 一键部署

#### 1. 下载脚本
```bash
# 直接下载
wget https://raw.githubusercontent.com/your-repo/deploy-script.sh
chmod +x deploy-script.sh

# 或者克隆仓库
git clone https://github.com/your-username/zhuhai-youmei-deploy.git
cd zhuhai-youmei-deploy
chmod +x Ubuntu22.04一键部署脚本.sh
```

#### 2. 执行部署
```bash
# 运行部署脚本
./Ubuntu22.04一键部署脚本.sh

# 或者带参数
./Ubuntu22.04一键部署脚本.sh deploy
```

#### 3. 跟随引导
```bash
# 脚本会引导您输入:
- 域名 (例如: example.com)
- 管理员邮箱
- 数据库密码
- Redis密码
- Django管理员密码
```

#### 4. 自动化安装
```bash
# 脚本自动完成:
✅ 系统环境检查
✅ 软件包安装 (Node.js, Python, PostgreSQL等)
✅ 数据库配置
✅ Django项目部署
✅ Vue前端构建
✅ Nginx配置
✅ SSL证书申请
✅ 服务启动
✅ 部署验证
```

### 🔧 Ubuntu管理命令

```bash
# 项目管理脚本
/var/www/zhuhai-youmei/scripts/status.sh    # 查看状态
/var/www/zhuhai-youmei/scripts/logs.sh      # 查看日志
/var/www/zhuhai-youmei/scripts/deploy.sh    # 更新部署
/var/www/zhuhai-youmei/scripts/backup.sh    # 数据备份

# 服务管理
sudo systemctl restart nginx                           # 重启Nginx
sudo supervisorctl restart zhuhai-youmei-backend      # 重启后端
sudo systemctl restart postgresql                     # 重启数据库
sudo systemctl restart redis-server                   # 重启Redis

# 应用管理
cd /var/www/zhuhai-youmei/backend
source venv/bin/activate
python manage.py migrate                              # 数据库迁移
python manage.py collectstatic --noinput             # 收集静态文件
python manage.py createsuperuser                     # 创建管理员

# 日志查看
tail -f /var/www/zhuhai-youmei/logs/backend.log       # 后端日志
sudo tail -f /var/log/nginx/error.log                # Nginx日志
sudo tail -f /var/log/postgresql/postgresql-15-main.log  # 数据库日志
```

### 🏗️ Ubuntu服务架构

```bash
系统服务:
├── Nginx (端口: 80, 443)
│   ├── 前端静态文件服务
│   └── API反向代理
├── Gunicorn + Supervisor
│   └── Django应用 (端口: 8000)
├── PostgreSQL (端口: 5432)
└── Redis (端口: 6379)

项目结构:
/var/www/zhuhai-youmei/
├── backend/           # Django后端
├── frontend/          # Vue前端
├── logs/             # 日志文件
├── backups/          # 备份文件
└── scripts/          # 管理脚本
```

---

## 🎯 选择建议

### 🐳 选择Docker部署的情况：

**✅ 推荐场景：**
- 开发和测试环境
- 需要快速部署和迁移
- 团队对Docker熟悉
- 需要多环境一致性
- 计划使用云原生平台

**✅ 优势：**
- 环境一致性好
- 部署简单快速
- 易于扩展和迁移
- 服务隔离安全
- 支持CI/CD自动化

**❌ 不适合：**
- 服务器资源有限
- 对性能要求极高
- 团队不熟悉容器技术

### 🖥️ 选择Ubuntu原生部署的情况：

**✅ 推荐场景：**
- 生产环境部署
- 对性能要求高
- 服务器资源有限
- 传统运维团队
- 需要精细化控制

**✅ 优势：**
- 性能最优
- 资源利用率高
- 故障排查容易
- 运维团队熟悉
- 成本相对较低

**❌ 不适合：**
- 需要频繁迁移
- 多环境管理复杂
- 团队缺乏Linux经验

---

## 🔄 迁移和升级

### Docker → Ubuntu迁移
```bash
# 1. 导出Docker数据
docker-compose exec postgres pg_dump -U youmei_user zhuhai_youmei > backup.sql
docker cp container_name:/app/media ./media_backup

# 2. 在Ubuntu环境恢复
./Ubuntu22.04一键部署脚本.sh deploy
psql -h localhost -U deploy zhuhai_youmei < backup.sql
cp -r media_backup/* /var/www/zhuhai-youmei/backend/media/
```

### Ubuntu → Docker迁移
```bash
# 1. 导出Ubuntu数据
pg_dump -h localhost -U deploy zhuhai_youmei > backup.sql
tar -czf media_backup.tar.gz /var/www/zhuhai-youmei/backend/media/

# 2. 在Docker环境恢复
./scripts/deploy.sh
docker-compose exec postgres psql -U youmei_user zhuhai_youmei < backup.sql
docker cp media_backup.tar.gz container_name:/app/
```

---

## 🚨 故障排除

### 常见问题及解决方案

#### Docker部署问题

```bash
# 1. 容器启动失败
docker-compose logs backend                    # 查看后端日志
docker-compose up backend                      # 前台启动查看错误

# 2. 数据库连接失败
docker-compose exec postgres psql -U youmei_user -d zhuhai_youmei
docker-compose restart postgres

# 3. 端口冲突
docker-compose down                            # 停止所有服务
sudo netstat -tlnp | grep :80                 # 检查端口占用
sudo pkill -f nginx                           # 杀死占用进程

# 4. 磁盘空间不足
docker system prune -a                        # 清理未使用镜像
docker volume prune                           # 清理未使用卷
```

#### Ubuntu部署问题

```bash
# 1. 服务启动失败
sudo systemctl status nginx                   # 检查Nginx状态
sudo supervisorctl status zhuhai-youmei-backend  # 检查后端状态
sudo nginx -t                                # 测试Nginx配置

# 2. 数据库连接失败
sudo systemctl status postgresql              # 检查数据库状态
sudo -u postgres psql -l                     # 检查数据库列表

# 3. 权限问题
sudo chown -R $USER:$USER /var/www/zhuhai-youmei
sudo chmod -R 755 /var/www/zhuhai-youmei

# 4. SSL证书问题
sudo certbot certificates                     # 检查证书状态
sudo certbot renew                           # 手动续期
```

---

## 📞 技术支持

### 获取帮助

**📚 文档资源：**
- Docker部署指南：`.same/Docker完整部署方案.md`
- Ubuntu部署指南：`.same/Django后端部署指南.md`
- 前端部署指南：`.same/阿里云部署指南.md`

**🛠️ 调试工具：**
```bash
# Docker环境
docker-compose logs -f                        # 实时日志
docker stats                                  # 资源使用
docker-compose exec backend python manage.py shell  # Django shell

# Ubuntu环境
/var/www/zhuhai-youmei/scripts/status.sh      # 系统状态
/var/www/zhuhai-youmei/scripts/logs.sh all    # 综合日志
htop                                          # 系统监控
```

**🔧 常用命令：**
```bash
# 健康检查
curl -f http://localhost/health/              # 检查API健康
curl -f http://localhost/                     # 检查前端

# 性能测试
ab -n 100 -c 10 http://localhost/            # Apache Bench测试
curl -w "@curl-format.txt" -o /dev/null -s http://localhost/  # 响应时间
```

---

## 🎉 部署成功后的下一步

### 1. 安全加固
```bash
# 设置防火墙
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'

# 安装fail2ban
sudo apt install fail2ban

# 定期安全更新
sudo apt update && sudo apt upgrade -y
```

### 2. 性能优化
```bash
# 数据库优化
sudo nano /etc/postgresql/15/main/postgresql.conf

# Nginx优化
sudo nano /etc/nginx/nginx.conf

# 启用HTTP/2
# 配置缓存策略
```

### 3. 监控设置
```bash
# 安装监控工具
sudo apt install htop iotop nethogs

# 设置日志轮转
sudo nano /etc/logrotate.d/zhuhai-youmei

# 配置告警通知
```

### 4. 备份策略
```bash
# 设置定时备份
crontab -e
# 添加：0 2 * * * /var/www/zhuhai-youmei/scripts/backup.sh

# 异地备份
rsync -avz /var/www/zhuhai-youmei/backups/ user@backup-server:/backups/
```

---

🎊 **恭喜！您已成功部署珠海优美化妆品官网！**

无论选择哪种部署方案，都能为您提供稳定、高性能的网站服务。如有任何问题，请参考相应的故障排除指南或查看详细的部署文档。
